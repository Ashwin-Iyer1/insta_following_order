(()=>{(async()=>{let f=e=>new Promise(o=>setTimeout(o,e)),i=location.pathname.split("/").filter(Boolean),g=["explore","reels","direct","stories","accounts","tv","p","ar","about","hashtag","locations","audio"],h=i.length>=1&&!g.includes(i[0]),t,s;if(h){let e=i[0];console.log(`On profile page \u2014 looking up user ID for @${e} ...`);let l=(await(await fetch(`https://www.instagram.com/web/search/topsearch/?query=${encodeURIComponent(e)}`,{credentials:"include"})).json()).users?.find(r=>r.user.username===e)?.user;if(!l)throw new Error(`User "${e}" not found in search results`);t=l.pk,s=e,console.log(`User ID: ${t}`)}else{let e=("; "+document.cookie).split("; ds_user_id=").length===2?("; "+document.cookie).split("; ds_user_id=").pop().split(";").shift():null;if(!e)throw new Error("Not logged in \u2014 ds_user_id cookie not found");t=e,s=e,console.log(`User ID: ${t}`)}let p="d04b0a864b4b54837c0d870b0e77e076",n=[],d=!0,c=null;for(;d;){let e={id:t,include_reel:!0,fetch_mutual:!0,first:50};c&&(e.after=c);let o=`https://www.instagram.com/graphql/query/?query_hash=${p}&variables=${encodeURIComponent(JSON.stringify(e))}`;await f(2e3+Math.random()*3e3);let a=await fetch(o,{credentials:"include"});if(!a.ok){console.error(`Request failed: ${a.status}`);break}let l=(await a.json()).data.user.edge_follow;for(let r of l.edges)n.push({username:r.node.username,full_name:r.node.full_name||""});d=l.page_info.has_next_page,c=l.page_info.end_cursor,console.log(`  Fetched ${n.length} so far ...`)}console.log(`
Total following: ${n.length}
`),console.log(`Most recently followed \u2192 oldest:
`),console.table(n.map((e,o)=>({"#":o+1,username:`@${e.username}`,full_name:e.full_name})));let w=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),u=document.createElement("a");u.href=URL.createObjectURL(w),u.download=`${s}_following.json`,u.click(),console.log(`
\u2713 Downloaded ${s}_following.json`)})();})();
