(()=>{(async()=>{let u=e=>new Promise(o=>setTimeout(o,e)),i=location.pathname.split("/").filter(Boolean),p=["explore","reels","direct","stories","accounts","tv","p","ar","about","hashtag","locations","audio"],f=i.length>=1&&!p.includes(i[0]),l,a;if(f){let e=i[0];console.log(`On profile page \u2014 looking up user ID for @${e} ...`);let n=(await(await fetch(`https://www.instagram.com/web/search/topsearch/?query=${encodeURIComponent(e)}`,{credentials:"include"})).json()).users?.find(s=>s.user.username===e)?.user;if(!n)throw new Error(`User "${e}" not found in search results`);l=n.pk,a=e,console.log(`User ID: ${l}`)}else{let e=("; "+document.cookie).split("; ds_user_id=").length===2?("; "+document.cookie).split("; ds_user_id=").pop().split(";").shift():null;if(!e)throw new Error("Not logged in \u2014 ds_user_id cookie not found");l=e,a=e,console.log(`User ID: ${l}`)}let h="d04b0a864b4b54837c0d870b0e77e076",t=[],m=!0,d=null;for(;m;){let e={id:l,include_reel:!0,fetch_mutual:!0,first:50};d&&(e.after=d);let o=`https://www.instagram.com/graphql/query/?query_hash=${h}&variables=${encodeURIComponent(JSON.stringify(e))}`;await u(2e3+Math.random()*3e3);let r=await fetch(o,{credentials:"include"});if(!r.ok){console.error(`Request failed: ${r.status}`);break}let n=(await r.json()).data.user.edge_follow;for(let s of n.edges)t.push({username:s.node.username,full_name:s.node.full_name||""});m=n.page_info.has_next_page,d=n.page_info.end_cursor,console.log(`  Fetched ${t.length} so far ...`)}console.log(`
Total following: ${t.length}
`),console.log(`Most recently followed \u2192 oldest:
`),console.table(t.map((e,o)=>({"#":o+1,username:`@${e.username}`,full_name:e.full_name})));let g=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),c=document.createElement("a");c.href=URL.createObjectURL(g),c.download=`${a}_following.json`,c.click(),console.log(`
\u2713 Downloaded ${a}_following.json`);let b=t.map((e,o)=>`
            <tr data-index="${o+1}" data-username="${e.username.toLowerCase()}" data-fullname="${e.full_name.toLowerCase()}">
                <td class="num">${o+1}</td>
                <td><a href="https://www.instagram.com/${e.username}/" target="_blank" rel="noreferrer">@${e.username}</a></td>
                <td class="full">${e.full_name}</td>
            </tr>`).join(""),w=`<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>${a} \u2014 Following (${t.length})</title>
<style>
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background:#0a0a0a;color:#e0e0e0;padding:2rem 1.5rem 4rem}
  h1{font-size:1.5rem;font-weight:700;color:#fff;margin-bottom:0.3rem}
  .meta{color:#666;font-size:0.85rem;margin-bottom:1.5rem}
  .meta span{color:#aaa}
  .toolbar{display:flex;gap:1rem;align-items:center;margin-bottom:1.2rem;flex-wrap:wrap}
  input{flex:1;min-width:200px;background:#141414;border:1px solid #2a2a2a;border-radius:8px;padding:0.6rem 1rem;color:#e0e0e0;font-size:0.9rem;outline:none}
  input:focus{border-color:#0070f3}
  input::placeholder{color:#555}
  .count{color:#555;font-size:0.85rem;white-space:nowrap}
  table{width:100%;border-collapse:collapse}
  thead th{text-align:left;padding:0.6rem 0.9rem;font-size:0.72rem;text-transform:uppercase;letter-spacing:0.07em;color:#555;border-bottom:1px solid #1e1e1e}
  tbody tr{border-bottom:1px solid #151515;transition:background 0.1s}
  tbody tr:hover{background:#121212}
  td{padding:0.65rem 0.9rem;font-size:0.875rem;vertical-align:middle}
  td.num{color:#444;width:3rem;font-size:0.78rem}
  td a{color:#a0c4ff;text-decoration:none;font-weight:500}
  td a:hover{text-decoration:underline}
  td.full{color:#888}
  .empty{text-align:center;padding:3rem;color:#444;font-size:0.9rem}
</style>
</head>
<body>
<h1>@${a} \u2014 Following</h1>
<p class="meta">Exported <span>${new Date().toLocaleString()}</span> &nbsp;\xB7&nbsp; <span>${t.length} accounts</span> &nbsp;\xB7&nbsp; most recently followed \u2192 oldest</p>
<div class="toolbar">
  <input id="q" type="text" placeholder="Filter by username or name\u2026" autofocus/>
  <span class="count" id="countLabel">${t.length} accounts</span>
</div>
<table>
  <thead><tr><th>#</th><th>Username</th><th>Full Name</th></tr></thead>
  <tbody id="tbody">${b}</tbody>
</table>
<p class="empty" id="empty" style="display:none">No results</p>
<script>
  (function(){
    var q=document.getElementById('q');
    var rows=Array.from(document.querySelectorAll('#tbody tr'));
    var label=document.getElementById('countLabel');
    var empty=document.getElementById('empty');
    function filter(){
      var v=q.value.trim();
      var c=0;
      var isNum=/^[0-9]+$/.test(v);
      rows.forEach(function(r){
        var match;
        if(v===''){
          match=true;
        } else if(isNum){
          match=r.dataset.index===v;
        } else {
          var lv=v.toLowerCase();
          match=r.dataset.username.indexOf(lv)!==-1||r.dataset.fullname.indexOf(lv)!==-1;
        }
        r.style.display=match?'':'none';
        if(match)c++;
      });
      label.textContent=c+' account'+(c===1?'':'s');
      empty.style.display=c===0?'block':'none';
    }
    q.addEventListener('input',filter);
    q.addEventListener('keyup',filter);
  })();
<\/script>
</body>
</html>`,y=new Blob([w],{type:"text/html"});window.open(URL.createObjectURL(y),"_blank"),console.log("\u2713 Opened visualisation tab")})();})();
