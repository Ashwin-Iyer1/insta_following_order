(()=>{(async()=>{let p=e=>new Promise(o=>setTimeout(o,e)),i=location.pathname.split("/").filter(Boolean),u=["explore","reels","direct","stories","accounts","tv","p","ar","about","hashtag","locations","audio"],f=i.length>=1&&!u.includes(i[0]),a,n;if(f){let e=i[0];console.log(`On profile page \u2014 looking up user ID for @${e} ...`);let l=(await(await fetch(`https://www.instagram.com/web/search/topsearch/?query=${encodeURIComponent(e)}`,{credentials:"include"})).json()).users?.find(s=>s.user.username===e)?.user;if(!l)throw new Error(`User "${e}" not found in search results`);a=l.pk,n=e,console.log(`User ID: ${a}`)}else{let e=("; "+document.cookie).split("; ds_user_id=").length===2?("; "+document.cookie).split("; ds_user_id=").pop().split(";").shift():null;if(!e)throw new Error("Not logged in \u2014 ds_user_id cookie not found");a=e,n=e,console.log(`User ID: ${a}`)}let h="d04b0a864b4b54837c0d870b0e77e076",t=[],m=!0,c=null;for(;m;){let e={id:a,include_reel:!0,fetch_mutual:!0,first:50};c&&(e.after=c);let o=`https://www.instagram.com/graphql/query/?query_hash=${h}&variables=${encodeURIComponent(JSON.stringify(e))}`;await p(2e3+Math.random()*3e3);let r=await fetch(o,{credentials:"include"});if(!r.ok){console.error(`Request failed: ${r.status}`);break}let l=(await r.json()).data.user.edge_follow;for(let s of l.edges)t.push({username:s.node.username,full_name:s.node.full_name||""});m=l.page_info.has_next_page,c=l.page_info.end_cursor,console.log(`  Fetched ${t.length} so far ...`)}console.log(`
Total following: ${t.length}
`),console.log(`Most recently followed \u2192 oldest:
`),console.table(t.map((e,o)=>({"#":o+1,username:`@${e.username}`,full_name:e.full_name})));let g=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),d=document.createElement("a");d.href=URL.createObjectURL(g),d.download=`${n}_following.json`,d.click(),console.log(`
\u2713 Downloaded ${n}_following.json`);let b=t.map((e,o)=>`
            <tr>
                <td class="num">${o+1}</td>
                <td><a href="https://www.instagram.com/${e.username}/" target="_blank" rel="noreferrer">@${e.username}</a></td>
                <td class="full">${e.full_name}</td>
            </tr>`).join(""),w=`<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>${n} \u2014 Following (${t.length})</title>
<style>
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background:#0a0a0a;color:#e0e0e0;padding:2rem 1.5rem 4rem}
  h1{font-size:1.5rem;font-weight:700;color:#fff;margin-bottom:0.3rem}
  .meta{color:#666;font-size:0.85rem;margin-bottom:1.5rem}
  .meta span{color:#aaa}
  .toolbar{display:flex;gap:1rem;align-items:center;margin-bottom:1.2rem;flex-wrap:wrap}
  input{flex:1;min-width:200px;background:#141414;border:1px solid #2a2a2a;border-radius:8px;padding:0.6rem 1rem;color:#e0e0e0;font-size:0.9rem;outline:none}
  input:focus{border-color:#0070f3}
  input::placeholder{color:#555}
  .count{color:#555;font-size:0.85rem;white-space:nowrap}
  table{width:100%;border-collapse:collapse}
  thead th{text-align:left;padding:0.6rem 0.9rem;font-size:0.72rem;text-transform:uppercase;letter-spacing:0.07em;color:#555;border-bottom:1px solid #1e1e1e}
  tbody tr{border-bottom:1px solid #151515;transition:background 0.1s}
  tbody tr:hover{background:#121212}
  tbody tr.hidden{display:none}
  td{padding:0.65rem 0.9rem;font-size:0.875rem;vertical-align:middle}
  td.num{color:#444;width:3rem;font-size:0.78rem}
  td a{color:#a0c4ff;text-decoration:none;font-weight:500}
  td a:hover{text-decoration:underline}
  td.full{color:#888}
  .empty{text-align:center;padding:3rem;color:#444;font-size:0.9rem}
</style>
</head>
<body>
<h1>@${n} \u2014 Following</h1>
<p class="meta">Exported <span>${new Date().toLocaleString()}</span> &nbsp;\xB7&nbsp; <span>${t.length} accounts</span> &nbsp;\xB7&nbsp; most recently followed \u2192 oldest</p>
<div class="toolbar">
  <input id="q" type="search" placeholder="Filter by username or name\u2026" autofocus/>
  <span class="count" id="countLabel">${t.length} accounts</span>
</div>
<table>
  <thead><tr><th>#</th><th>Username</th><th>Full Name</th></tr></thead>
  <tbody id="tbody">${b}</tbody>
</table>
<p class="empty" id="empty" style="display:none">No results</p>
<script>
  const q=document.getElementById('q');
  const rows=document.querySelectorAll('#tbody tr');
  const label=document.getElementById('countLabel');
  const empty=document.getElementById('empty');
  q.addEventListener('input',()=>{
    const v=q.value.toLowerCase();
    let c=0;
    rows.forEach(r=>{
      const match=r.textContent.toLowerCase().includes(v);
      r.classList.toggle('hidden',!match);
      if(match)c++;
    });
    label.textContent=c+' account'+(c===1?'':'s');
    empty.style.display=c===0?'block':'none';
  });
<\/script>
</body>
</html>`,y=new Blob([w],{type:"text/html"});window.open(URL.createObjectURL(y),"_blank"),console.log("\u2713 Opened visualisation tab")})();})();
